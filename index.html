<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brokers High-Stakes Shell Game</title>
    <style>
        :root { --bg: #1a1a1a; --accent: #e63946; --cup-color: #8b5a2b; }
        body { background: var(--bg); color: #d4a373; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .game-box { border: 4px solid #444; padding: 40px; background: #2a2a2a; text-align: center; width: 550px; }
        .cups-wrapper { display: flex; justify-content: space-around; height: 200px; align-items: flex-end; position: relative; margin: 30px 0; }
        .cup-slot { width: 100px; position: relative; transition: transform 0.4s ease-in-out; }
        .cup { 
            width: 100px; height: 120px; background: var(--cup-color); border-radius: 10px 10px 40px 40px; 
            border: 3px solid #5d3a1a; cursor: pointer; position: relative; z-index: 2;
            transition: transform 0.4s, background 0.3s;
        }
        .cup.lifted { transform: translateY(-70px) rotate(-10deg); }
        .coin-stack { 
            position: absolute; bottom: 15px; left: 0; right: 0; margin: auto;
            z-index: 1; display: none; flex-direction: column-reverse; align-items: center;
        }
        .coin-stack.visible { display: flex; }
        .mini-coin { 
            width: 40px; height: 10px; background: #ffd700; border-radius: 5px; 
            border: 1px solid #b8860b; margin-bottom: -5px; box-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .message { font-size: 1.2rem; height: 60px; margin-top: 20px; color: #eee; font-weight: bold; }
        button { padding: 12px 24px; background: var(--accent); color: white; border: none; cursor: pointer; font-family: inherit; font-size: 1rem; }
        button:disabled { background: #555; }
    </style>
</head>
<body>

    <h1 style="color: var(--accent); text-shadow: 2px 2px #000;">ğŸ’° HIGH-STAKES YABAWI</h1>
    <div class="game-box">
        <p id="sub-msg">"ëˆì´ ì–´ë””ë¡œ ê°€ëŠ”ì§€ ë˜‘ë˜‘íˆ ë´ë¼..."</p>
        <div class="cups-wrapper" id="stage">
            <div class="cup-slot" id="slot-0" onclick="reveal(0)">
                <div class="cup" id="cup-0"></div>
                <div class="coin-stack" id="coins-0"></div>
            </div>
            <div class="cup-slot" id="slot-1" onclick="reveal(1)">
                <div class="cup" id="cup-1"></div>
                <div class="coin-stack" id="coins-1"></div>
            </div>
            <div class="cup-slot" id="slot-2" onclick="reveal(2)">
                <div class="cup" id="cup-2"></div>
                <div class="coin-stack" id="coins-2"></div>
            </div>
        </div>
        <div class="message" id="status">íŒëˆì„ ê±¸ ì¤€ë¹„ê°€ ë˜ì—ˆë‚˜?</div>
        <button id="start-btn" onclick="prepareGame()">ê²Œì„ ì‹œì‘</button>
    </div>

    <script>
        let coinPos = 1;
        let coinCount = 0;
        let isActive = false;
        let isGameOver = true;

        function prepareGame() {
            if (isActive) return;
            isActive = true;
            isGameOver = false;

            // 1. ëœë¤ ì½”ì¸ ê°œìˆ˜ ì„¤ì • (2~5ê°œ)
            coinCount = Math.floor(Math.random() * 4) + 2;
            coinPos = Math.floor(Math.random() * 3);

            // 2. ì´ˆê¸°í™” ë° ì½”ì¸ ìƒì„±
            document.querySelectorAll('.cup').forEach(c => c.classList.remove('lifted'));
            document.querySelectorAll('.coin-stack').forEach(s => {
                s.classList.remove('visible');
                s.innerHTML = '';
            });
            document.getElementById('start-btn').disabled = true;

            const targetStack = document.getElementById(`coins-${coinPos}`);
            for(let i=0; i<coinCount; i++) {
                const c = document.createElement('div');
                c.className = 'mini-coin';
                targetStack.appendChild(c);
            }

            // 3. ì²˜ìŒì— ì–´ë”” ìˆëŠ”ì§€ ë³´ì—¬ì£¼ê¸°
            document.getElementById('status').innerText = `ì—¬ê¸°ì— ${coinCount}ì½”ì¸ì„ ë„£ì—ˆë‹¤. ì˜ ë´ë¼!`;
            targetStack.classList.add('visible');
            document.getElementById(`cup-${coinPos}`).classList.add('lifted');

            setTimeout(() => {
                document.getElementById(`cup-${coinPos}`).classList.remove('lifted');
                setTimeout(shuffleGame, 800);
            }, 1500);
        }

        function shuffleGame() {
            document.getElementById('status').innerText = "ì„ëŠ”ë‹¤! ëˆˆ ë–¼ì§€ ë§ˆë¼!";
            let shuffles = 0;
            const maxShuffles = 12;

            const interval = setInterval(() => {
                const s1 = Math.floor(Math.random() * 3);
                let s2 = Math.floor(Math.random() * 3);
                while(s1 === s2) s2 = Math.floor(Math.random() * 3);
                
                visualSwap(s1, s2);
                
                if (coinPos === s1) coinPos = s2;
                else if (coinPos === s2) coinPos = s1;

                shuffles++;
                if (shuffles >= maxShuffles) {
                    clearInterval(interval);
                    isActive = false;
                    document.getElementById('status').innerText = "ì, ê³¨ë¼ë´. ì–´ë””ì— ìˆì§€?";
                }
            }, 450);
        }

        function visualSwap(i, j) {
            const slot1 = document.getElementById(`slot-${i}`);
            const slot2 = document.getElementById(`slot-${j}`);
            const diff = (j - i) * 150;
            
            slot1.style.transform = `translateX(${diff}px)`;
            slot2.style.transform = `translateX(${-diff}px)`;

            setTimeout(() => {
                slot1.style.transition = 'none';
                slot2.style.transition = 'none';
                
                // ì‹¤ì œ ìœ„ì¹˜ë¥¼ ë°”ê¾¸ëŠ” ëŒ€ì‹  ì‹œê°ì  íš¨ê³¼ë§Œ ìœ ì§€
                // (ì´ ë¡œì§ì€ ê°„ë‹¨í•œ êµ¬í˜„ì„ ìœ„í•´ ì‹œê°ì  swap í›„ ì´ˆê¸°í™” ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤)
                // ì‹¤ì œ ìš´ì˜ ì‹œì—ëŠ” DOM ìš”ì†Œì˜ IDë‚˜ ìˆœì„œë¥¼ êµì²´í•˜ëŠ” ê²ƒì´ ë” ì •í™•í•©ë‹ˆë‹¤.
                
                // ì½”ì¸ ìŠ¤íƒì˜ ê°€ì‹œì„± ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸
                const stackI = document.getElementById(`coins-${i}`).innerHTML;
                const stackJ = document.getElementById(`coins-${j}`).innerHTML;
                document.getElementById(`coins-${i}`).innerHTML = stackJ;
                document.getElementById(`coins-${j}`).innerHTML = stackI;
                
                const visibleI = document.getElementById(`coins-${i}`).classList.contains('visible');
                const visibleJ = document.getElementById(`coins-${j}`).classList.contains('visible');
                
                if(visibleI) { document.getElementById(`coins-${i}`).classList.remove('visible'); document.getElementById(`coins-${j}`).classList.add('visible'); }
                else if(visibleJ) { document.getElementById(`coins-${j}`).classList.remove('visible'); document.getElementById(`coins-${i}`).classList.add('visible'); }

                slot1.style.transform = '';
                slot2.style.transform = '';
                setTimeout(() => {
                    slot1.style.transition = 'transform 0.4s ease-in-out';
                    slot2.style.transition = 'transform 0.4s ease-in-out';
                }, 50);
            }, 400);
        }

        function reveal(idx) {
            if (isActive || isGameOver) return;
            isGameOver = true;

            document.getElementById(`cup-${idx}`).classList.add('lifted');
            const targetStack = document.getElementById(`coins-${idx}`);
            targetStack.classList.add('visible');

            if (idx === coinPos) {
                document.getElementById('status').innerHTML = `<span style="color:#4ade80">ì¶•í•˜í•œë‹¤! ${coinCount}ì½”ì¸ì„ íšë“í–ˆë‹¤!</span>`;
            } else {
                document.getElementById('status').innerHTML = `<span style="color:#f87171">ê½ì´ë‹¤. ì½”ì¸ì€ ë‹¤ë¥¸ ê³³ì— ìˆì—ˆì–´.</span>`;
                document.getElementById(`cup-${coinPos}`).classList.add('lifted');
                document.getElementById(`coins-${coinPos}`).classList.add('visible');
            }
            document.getElementById('start-btn').disabled = false;
            document.getElementById('start-btn').innerText = "ì¬ë„ì „ í•˜ê¸°";
        }
    </script>
</body>
</html>
