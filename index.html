<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Black Market Pawn Shop</title>
    <style>
        :root { --bg-deep: #0a0a0b; --illegal-red: #ff3333; }
        * { image-rendering: pixelated; box-sizing: border-box; font-family: 'Maplestory OTF Light', 'Courier New', monospace; }
        
        body {
            margin: 0; height: 100vh;
            background: var(--bg-deep) url('https://github.com/bagjueun307/-/blob/main/%EC%A0%84%EC%B2%B4.png?raw=true') no-repeat center center;
            background-size: cover;
            display: flex; flex-direction: column; align-items: center;
            color: #eee; overflow: hidden;
        }

        /* [감정 중] 한국어 깜빡이 애니메이션 */
        @keyframes scan-korean {
            0%, 100% { opacity: 1; color: #fff; text-shadow: 0 0 5px var(--illegal-red); }
            50% { opacity: 0.3; color: var(--illegal-red); }
        }
        .scanning { animation: scan-korean 0.15s infinite; font-weight: bold; }

        .appraisal-sheet {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            width: 520px; background: rgba(230, 230, 220, 0.95);
            border: 5px solid #111; padding: 20px; color: #111;
            box-shadow: 15px 15px 0px rgba(0,0,0,0.7); z-index: 100;
        }

        .sheet-header { border-bottom: 3px solid #111; padding-bottom: 8px; margin-bottom: 12px; font-weight: bold; font-size: 14px; display: flex; justify-content: space-between; }
        .dialogue-text { height: 50px; font-size: 18px; font-weight: bold; margin-bottom: 12px; border-left: 6px solid var(--illegal-red); padding-left: 15px; display: flex; align-items: center; }

        .btn-group { display: flex; gap: 12px; }
        button { padding: 12px 20px; border: 4px solid #111; cursor: pointer; font-weight: bold; font-size: 16px; }
        .btn-accept { background: #3d5a3d; color: white; }
        .btn-deny { background: #a32a2a; color: white; }

        /* [컵 사이즈 300% 확대] */
        .game-zone { position: absolute; bottom: 10%; width: 100%; height: 450px; display: flex; justify-content: center; }

        .cup {
            position: absolute; 
            width: 320px;  /* 대폭 확대 */
            height: 380px; /* 대폭 확대 */
            background: url('https://github.com/bagjueun307/-/blob/main/%EC%BB%B5%20%EC%97%8E%EC%9D%80%20%ED%98%95%ED%83%9C%20%EC%9D%B4%EB%AF%B8%EC%A7%80.png?raw=true') no-repeat center center;
            background-size: contain;
            transition: left 0.5s cubic-bezier(0.4, 0, 0.2, 1), transform 0.4s ease; 
            cursor: pointer; z-index: 10;
        }

        .cup.lifted {
            background-image: url('https://github.com/bagjueun307/-/blob/main/%EC%9C%84%EB%A1%9C%20%ED%96%A5%ED%95%9C%20%EC%BB%B5%20%EC%9D%B4%EB%AF%B8%EC%A7%80.png?raw=true');
            transform: translateY(-180px); /* 컵이 커진 만큼 더 높이 들림 */
        }

        /* [코인 더미 가시성 강화] */
        .coin-stack { 
            position: absolute; bottom: 20px; 
            width: 320px; height: 120px; 
            display: none; justify-content: center; align-items: flex-end; 
            z-index: 5; /* 컵보다는 아래, 바닥보다는 위 */
        }
        .coin-stack.visible { display: flex; }
        
        .pixel-coin {
            width: 120px; height: 120px; /* 코인 크기도 대폭 확대 */
            background: url('https://github.com/bagjueun307/-/blob/main/%EC%BD%94%EC%9D%B8%20%EC%9D%B4%EB%AF%B8%EC%A7%80%20%EC%A0%95%EC%B8%A1%EB%A9%B4.png?raw=true') no-repeat center center;
            background-size: contain;
            margin: 0 -30px; 
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
        }
    </style>
</head>
<body>

    <div class="appraisal-sheet">
        <div class="sheet-header">
            <span>불법 물건 감정서 (ILLEGAL AUTH)</span>
            <span id="balance-display">보유 코인: 0</span>
        </div>
        <div id="dialogue" class="dialogue-text">"가진 게 있으면 꺼내봐. 돈 좀 되려나?"</div>
        
        <div id="item-info" style="display:none; border-top: 3px dashed #111; padding: 12px 0;">
            <div style="display:flex; justify-content: space-between; font-weight: bold; font-size: 20px;">
                <span id="item-name"></span>
                <span id="item-val"></span>
            </div>
        </div>

        <div class="btn-group">
            <button id="btn-main" class="btn-accept" onclick="startAppraisal()">물건 꺼내기</button>
            <button id="btn-re" class="btn-deny" onclick="startAppraisal()" style="display:none;">다른 물건</button>
        </div>
    </div>

    <div class="game-zone">
        <div id="slot-0" class="cup" style="left: calc(50% - 550px);" onclick="select(0)"></div>
        <div id="slot-1" class="cup" style="left: calc(50% - 160px);" onclick="select(1)"></div>
        <div id="slot-2" class="cup" style="left: calc(50% + 230px);" onclick="select(2)"></div>
        
        <div id="stack-0" class="coin-stack" style="left: calc(50% - 550px);"></div>
        <div id="stack-1" class="coin-stack" style="left: calc(50% - 160px);"></div>
        <div id="stack-2" class="coin-stack" style="left: calc(50% + 230px);"></div>
    </div>

<script>
    let wallet = 0; let playing = false; let finished = true; let coinPos = 1; let currentVal = 0;

    const items = [
        { n: "장물 다이아", v: 100, m: "오... 빛깔 좋군. 한 판 벌려보자고." },
        { n: "밀수 금괴", v: 50, m: "묵직하군. 눈 크게 뜨고 잘 보라고!" },
        { n: "명품 시계", v: 30, m: "시간이 금이지. 자, 섞는다!" },
        { n: "희귀 우표", v: 10, m: "이런 종이 쪼가리도 돈이 되지. 시작한다." }
    ];

    function startAppraisal() {
        if(playing) return;
        const diag = document.getElementById('dialogue');
        const itemInfo = document.getElementById('item-info');
        
        // [감정 연출] 한국어 메시지 및 깜빡임
        diag.classList.add('scanning');
        itemInfo.style.display = 'none';
        
        const scanTexts = ["장물 여부 확인 중...", "정밀 판독 중...", "가치 산정 중..."];
        let i = 0;
        const interval = setInterval(() => {
            diag.innerText = scanTexts[i++ % scanTexts.length];
        }, 300);

        setTimeout(() => {
            clearInterval(interval);
            diag.classList.remove('scanning');
            const item = items[Math.floor(Math.random() * items.length)];
            currentVal = item.v;
            itemInfo.style.display = 'block';
            document.getElementById('item-name').innerText = `[${item.n}]`;
            document.getElementById('item-val').innerText = `가치: ${item.v}코인`;
            diag.innerText = `"${item.m}"`;
            document.getElementById('btn-main').innerText = "야바위 시작";
            document.getElementById('btn-main').onclick = startShuffle;
            document.getElementById('btn-re').style.display = 'inline-block';
            document.getElementById('btn-re').innerText = "다른 물건";
        }, 1500);
    }

    function startShuffle() {
        playing = true; finished = false;
        document.querySelectorAll('.coin-stack').forEach(s => s.classList.remove('visible'));
        
        coinPos = Math.floor(Math.random()*3);
        const targetStack = document.getElementById(`stack-${coinPos}`);
        
        // 코인 더미 생성
        targetStack.innerHTML = '';
        const coinCount = Math.min(6, Math.ceil(currentVal / 15));
        for(let i=0; i < coinCount; i++) {
            targetStack.innerHTML += '<div class="pixel-coin"></div>';
        }

        // 시작 전 확인 연출
        document.getElementById(`slot-${coinPos}`).classList.add('lifted');
        targetStack.classList.add('visible');

        setTimeout(() => {
            document.getElementById(`slot-${coinPos}`).classList.remove('lifted');
            setTimeout(() => { 
                targetStack.classList.remove('visible');
                performShuffle(0, 12, 0.4); 
            }, 600);
        }, 1200);
    }

    function performShuffle(count, total, speed) {
        if(count >= total) {
            playing = false;
            document.getElementById('dialogue').innerText = "자... 어디에 들었지? 골라봐.";
            return;
        }
        let a = Math.floor(Math.random()*3);
        let b = Math.floor(Math.random()*3);
        while(a === b) b = Math.floor(Math.random()*3);

        const cupA = document.getElementById(`slot-${a}`);
        const cupB = document.getElementById(`slot-${b}`);
        const stackA = document.getElementById(`stack-${a}`);
        const stackB = document.getElementById(`stack-${b}`);

        const tempLeft = cupA.style.left;
        cupA.style.left = cupB.style.left;
        cupB.style.left = tempLeft;
        stackA.style.left = stackB.style.left;
        stackB.style.left = tempLeft;

        if(coinPos === a) coinPos = b;
        else if(coinPos === b) coinPos = a;

        setTimeout(() => performShuffle(count + 1, total, speed), speed * 1000);
    }

    function select(id) {
        if(playing || finished) return;
        finished = true;
        
        // 모든 컵을 들어서 결과 공개
        for(let i=0; i<3; i++) {
            document.getElementById(`slot-${i}`).classList.add('lifted');
            if(i === coinPos) {
                document.getElementById(`stack-${i}`).classList.add('visible');
            }
        }

        if(id === coinPos) {
            wallet += currentVal;
            document.getElementById('dialogue').innerText = "정답이야! 눈썰미가 보통이 아닌데?";
        } else {
            document.getElementById('dialogue').innerText = "틀렸어. 이건 이제 내 거야.";
        }

        document.getElementById('balance-display').innerText = `보유 코인: ${wallet}`;
        setTimeout(() => {
            document.getElementById('btn-main').innerText = "다른 물건 꺼내기";
            document.getElementById('btn-main').onclick = startAppraisal;
        }, 2000);
    }
</script>
</body>
</html>
