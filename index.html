<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Black Market Pawn Shop</title>
    <style>
        :root {
            --bg-deep: #0a0a0b;
            --desk-iron: #2c2c2e;
            --illegal-red: #a32a2a;
        }

        * { image-rendering: pixelated; box-sizing: border-box; font-family: 'Courier New', monospace; }
        
        body {
            margin: 0; height: 100vh;
            background-color: var(--bg-deep);
            background-image: radial-gradient(#1a1a1c 1px, transparent 1px);
            background-size: 16px 16px;
            display: flex; flex-direction: column; align-items: center;
            color: #b0b0b5; overflow: hidden;
        }

        /* [도트 연산] 전당포 사장님 실루엣 */
        .pawn-window {
            position: relative; width: 100%; height: 280px;
            background: 
                /* 창살 */
                linear-gradient(90deg, transparent 48%, #111 48%, #111 52%, transparent 52%) 0 0 / 120px 100% repeat-x,
                /* 사장님 (CSS로 그린 도트 인물) */
                radial-gradient(circle at 50% 40%, #5d4037 30px, transparent 31px) no-repeat, /* 머리 */
                linear-gradient(#151517, #151517) 50% 60% / 100px 150px no-repeat; /* 몸통 */
            border-bottom: 10px solid #1a1a1c;
        }

        .iron-desk {
            width: 100%; height: 100%; background: var(--desk-iron);
            border-top: 4px solid #444; position: relative;
            display: flex; flex-direction: column; align-items: center;
        }

        /* 서류 UI */
        .appraisal-sheet {
            width: 460px; background: #d1d1ca; border: 4px solid #111;
            padding: 20px; color: #111; margin-top: -70px;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.5); z-index: 50;
        }

        .sheet-header { border-bottom: 2px solid #111; padding-bottom: 5px; margin-bottom: 15px; font-weight: bold; font-size: 12px; display: flex; justify-content: space-between; }
        .dialogue-text { height: 45px; font-size: 14px; font-weight: bold; margin-bottom: 15px; border-left: 4px solid var(--illegal-red); padding-left: 10px; display: flex; align-items: center; }

        .btn-group { display: flex; gap: 10px; }
        button {
            padding: 10px 18px; border: 4px solid #111; cursor: pointer;
            font-size: 13px; font-weight: bold; transition: 0.1s;
        }
        .btn-accept { background: #4a5d4a; color: white; }
        .btn-deny { background: #8e2424; color: white; }
        button:active { transform: translateY(3px); }
        button:disabled { background: #888; color: #aaa; cursor: not-allowed; }

        /* 야바위 구역 */
        .game-zone { position: relative; width: 600px; height: 160px; margin-top: 35px; }
        .cup {
            position: absolute; width: 85px; height: 105px;
            background: linear-gradient(to right, #34495e, #1a1a1c, #34495e);
            border: 4px solid #111; border-radius: 4px 4px 10px 10px;
            transition: 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer;
        }
        .lifted { transform: translateY(-75px) rotate(-10deg); }

        .pixel-coin {
            position: absolute; bottom: 12px; width: 36px; height: 12px;
            background: #ffd700; border: 2px solid #b8860b; display: none; z-index: -1;
        }

        #balance-display { color: #2e7d32; }
    </style>
</head>
<body>

    <div class="pawn-window"></div>

    <div class="iron-desk">
        <div class="appraisal-sheet">
            <div class="sheet-header">
                <span>ILLEGAL AUTHENTICATION</span>
                <span id="balance-display">WALLET: 0 COINS</span>
            </div>
            <div id="dialogue" class="dialogue-text">"뒤에 경찰 없지? 물건이나 내놔봐."</div>
            
            <div id="item-info" style="display:none; border-top: 2px dashed #111; padding: 10px 0;">
                <div style="display:flex; justify-content: space-between; font-weight: bold;">
                    <span id="item-name" style="color:var(--illegal-red);"></span>
                    <span id="item-val"></span>
                </div>
            </div>

            <div class="btn-group">
                <button id="btn-main" class="btn-accept" onclick="startAppraisal(false)">물건 감정</button>
                <button id="btn-re" class="btn-deny" onclick="startAppraisal(true)" style="display:none;">다른 물건</button>
            </div>
        </div>

        <div class="game-zone">
            <div id="slot-0" class="cup" style="left: 80px;" onclick="select(0)"></div>
            <div id="slot-1" class="cup" style="left: 260px;" onclick="select(1)"></div>
            <div id="slot-2" class="cup" style="left: 440px;" onclick="select(2)"></div>
            <div id="coin-actor" class="pixel-coin"></div>
        </div>
    </div>

<script>
    let wallet = 0;
    let playing = false;
    let finished = true;
    let coinPos = 1;
    let currentVal = 0;

    const items = [
        { n: "장물 다이아", v: 5, m: "오... 빛깔 좋군. 이 정도면 판을 벌릴만 해." },
        { n: "밀수 금괴", v: 4, m: "묵직하군. 제대로 눈 크게 뜨고 보라고." },
        { n: "암시장 칩", v: 3, m: "정보가 가득 들었군. 어디 숨겼는지 맞춰봐." },
        { n: "명품 시계", v: 2, m: "시간이 금이지. 자, 섞는다!" },
        { n: "은수저", v: 1, m: "이런 짜질구레한 건 연습용으로 딱이지." }
    ];

    function startAppraisal(isRetry) {
        if(playing) return;
        const diag = document.getElementById('dialogue');
        const btnMain = document.getElementById('btn-main');
        const btnRe = document.getElementById('btn-re');

        btnMain.disabled = btnRe.disabled = true;
        diag.innerText = isRetry ? "흥, 그거보다 나은 게 있다고? (감정 중...)" : "어디 보자... (장갑을 끼며)";

        setTimeout(() => {
            const item = items[Math.floor(Math.random() * items.length)];
            currentVal = item.v;

            document.getElementById('item-info').style.display = 'block';
            document.getElementById('item-name').innerText = `[${item.n}]`;
            document.getElementById('item-val').innerText = `VALUE: ${item.v}`;
            diag.innerText = `"${item.m}"`;

            btnMain.disabled = btnRe.disabled = false;
            btnMain.innerText = "야바위 수락";
            btnMain.onclick = startShuffle;
            btnRe.style.display = 'inline-block';
        }, 1000);
    }

    function startShuffle() {
        playing = true; finished = false;
        document.getElementById('btn-main').disabled = true;
        document.getElementById('btn-re').disabled = true;
        
        coinPos = Math.floor(Math.random()*3);
        const coin = document.getElementById('coin-actor');
        const cups = document.querySelectorAll('.cup');
        
        // 코인 위치 보여주기
        cups[coinPos].classList.add('lifted');
        coin.style.display = 'block';
        coin.style.left = (parseInt(cups[coinPos].style.left) + 24) + "px";

        setTimeout(() => {
            cups[coinPos].classList.remove('lifted');
            coin.style.display = 'none';
            
            // 승률 조절: 셔플 횟수를 7회로 줄이고, 속도를 완화함
            const speed = [0, 0.6, 0.5, 0.45, 0.4, 0.35][currentVal];
            performShuffle(0, 7, speed);
        }, 1200);
    }

    function performShuffle(count, total, speed) {
        if(count >= total) {
            playing = false;
            document.getElementById('dialogue').innerText = "자, 어느 쪽이지? 선택해.";
            return;
        }

        let a = Math.floor(Math.random()*3);
        let b = Math.floor(Math.random()*3);
        while(a === b) b = Math.floor(Math.random()*3);

        const cupA = document.getElementById(`slot-${a}`);
        const cupB = document.getElementById(`slot-${b}`);
        const tempLeft = cupA.style.left;

        cupA.style.transition = cupB.style.transition = `${speed}s ease-in-out`;
        cupA.style.left = cupB.style.left;
        cupB.style.left = tempLeft;

        if(coinPos === a) coinPos = b;
        else if(coinPos === b) coinPos = a;

        setTimeout(() => performShuffle(count + 1, total, speed), speed * 1050);
    }

    function select(id) {
        if(playing || finished) return;
        finished = true;
        const cups = document.querySelectorAll('.cup');
        const coin = document.getElementById('coin-actor');
        
        cups[id].classList.add('lifted');
        if(id === coinPos) {
            coin.style.display = 'block';
            coin.style.left = (parseInt(cups[id].style.left) + 24) + "px";
            wallet += currentVal;
            document.getElementById('dialogue').innerText = "호오, 제법인데? 여기 약속한 코인이다.";
        } else {
            document.getElementById('dialogue').innerText = "땡! 이건 내 거야. 불만 있으면 경찰을 부르든가.";
            setTimeout(() => cups[coinPos].classList.add('lifted'), 500);
        }

        document.getElementById('balance-display').innerText = `WALLET: ${wallet} COINS`;

        setTimeout(() => {
            document.getElementById('item-info').style.display = 'none';
            document.getElementById('btn-re').style.display = 'none';
            document.getElementById('btn-main').disabled = false;
            document.getElementById('btn-main').innerText = "다른 물건 꺼내기";
            document.getElementById('btn-main').onclick = () => startAppraisal(false);
            cups.forEach(c => c.classList.remove('lifted'));
            coin.style.display = 'none';
        }, 2500);
    }
</script>
</body>
</html>
