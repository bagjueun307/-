<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Secret Pawn Shop</title>
    <style>
        * { image-rendering: pixelated; box-sizing: border-box; cursor: crosshair; }
        body {
            margin: 0; height: 100vh;
            background: #0a0a0a url('background.png') no-repeat center center;
            background-size: cover;
            display: flex; flex-direction: column; align-items: center;
            font-family: 'Courier New', monospace; color: #eee;
            overflow: hidden;
        }

        /* 상단 지갑 정보 */
        .top-bar {
            width: 100%; padding: 20px; display: flex; justify-content: flex-start;
        }
        .wallet {
            background: rgba(0,0,0,0.8); border: 3px solid #5d3a1a; padding: 10px 20px;
            box-shadow: 5px 5px 0px #000;
        }

        /* 중앙 감정 & 대화창 (일체형) */
        .appraisal-center {
            width: 500px; background: rgba(15, 15, 15, 0.95);
            border: 4px solid #5d3a1a; margin-top: 20px; padding: 20px;
            text-align: center; box-shadow: 0px 10px 20px rgba(0,0,0,0.5);
            z-index: 100;
        }

        /* 아이템 도트 이미지 표시 구역 */
        .item-visual {
            width: 80px; height: 80px; margin: 10px auto;
            background-color: #222; border: 2px solid #333;
            display: flex; align-items: center; justify-content: center;
        }
        .item-visual img { width: 64px; height: 64px; }

        .rarity-common { color: #888; }
        .rarity-rare { color: #4facfe; }
        .rarity-legendary { color: #ffd700; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* 야바위판 구역 */
        .game-board {
            position: relative; width: 500px; height: 150px; margin-top: 50px;
        }
        .cup-slot { position: absolute; width: 90px; height: 110px; transition: all 0.4s ease-in-out; display: flex; justify-content: center; align-items: flex-end; }
        .cup-pixel { width: 70px; height: 90px; background: #8b5a2b; border: 4px solid #3e2712; border-radius: 8px 8px 25px 25px; z-index: 2; transition: transform 0.4s; position: relative; }
        .cup-pixel::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: #a67c52; border-bottom: 2px solid #3e2712; }
        .lifted .cup-pixel { transform: translateY(-70px) rotate(-10deg); }
        .coin-stack { position: absolute; bottom: 8px; display: none; z-index: 1; }
        .coin-stack.visible { display: flex; flex-direction: column-reverse; }
        .dot-coin { width: 30px; height: 8px; background: #ffd700; border: 2px solid #b8860b; margin-bottom: -4px; }

        /* 컨트롤 버튼 */
        button {
            background: #e63946; color: white; border: none; padding: 15px 30px;
            font-family: inherit; font-weight: bold; cursor: pointer;
            border-bottom: 4px solid #9d2630; margin-top: 15px;
        }
        button:active { border-bottom: none; transform: translateY(4px); }
        button:disabled { background: #333; color: #666; border-bottom: none; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="wallet">
            <span style="color:#666; font-size: 0.8rem;">PURSE:</span> 
            <span id="balance" style="color:#ffd700; font-size: 1.2rem; font-weight: bold;">0 COINS</span>
        </div>
    </div>

    <div class="appraisal-center" id="ui-panel">
        <div id="dialogue">"주머니에 든 거 그거 명품인가? 어디 한번 꺼내보게."</div>
        
        <div id="item-info-area" style="display: none;">
            <div class="item-visual" id="item-img-slot">
                <img id="item-icon" src="" alt="item">
            </div>
            <div id="item-rarity" style="font-size: 0.7rem;"></div>
            <div id="item-name" style="font-size: 1.2rem; margin-bottom: 5px;"></div>
            <div id="bet-details" style="color: #ffd700; font-size: 0.9rem; border-top: 1px solid #333; padding-top: 10px;"></div>
        </div>

        <button id="main-btn" onclick="triggerAppraisal()">아이템 꺼내기</button>
    </div>

    <div class="game-board">
        <div class="cup-slot" id="slot-0" style="left: 40px;" onclick="handleSelect(0)">
            <div class="cup-pixel"></div>
            <div id="coins-0" class="coin-stack"></div>
        </div>
        <div class="cup-slot" id="slot-1" style="left: 205px;" onclick="handleSelect(1)">
            <div class="cup-pixel"></div>
            <div id="coins-1" class="coin-stack"></div>
        </div>
        <div class="cup-slot" id="slot-2" style="left: 370px;" onclick="handleSelect(2)">
            <div class="cup-pixel"></div>
            <div id="coins-2" class="coin-stack"></div>
        </div>
    </div>

<script>
    let coins = 0;
    let playing = false;
    let finished = true;
    let coinPos = 1;
    let rewards = { win: 0, lose: 0 };

    // 아이템 데이터 (이미지 경로 포함)
    const lootTable = [
        { name: "낡은 롤렉스", rarity: "RARE", min: 2, max: 4, img: "rolex.png", reactions: ["오호, 태엽 소리가 아주 정교하구먼."] },
        { name: "명품 선글라스", rarity: "LEGENDARY", min: 4, max: 5, img: "glasses.png", reactions: ["이건...! 헐리우드 배우가 쓰던 거 아닌가?"] },
        { name: "은도금 반지", rarity: "COMMON", min: 1, max: 2, img: "ring.png", reactions: ["은치고는 좀 탁하지만... 받아주지."] }
    ];

    function triggerAppraisal() {
        if (playing) return;
        const item = lootTable[Math.floor(Math.random() * lootTable.length)];
        
        document.getElementById('item-info-area').style.display = 'block';
        document.getElementById('item-icon').src = item.img; // 실제 이미지 파일명과 매칭
        document.getElementById('item-name').innerText = item.name;
        document.getElementById('item-rarity').innerText = `[${item.rarity}]`;
        document.getElementById('item-rarity').className = `rarity-${item.rarity.toLowerCase()}`;
        document.getElementById('dialogue').innerText = "사장이 돋보기를 꺼내 감정 중입니다...";
        
        document.getElementById('main-btn').disabled = true;
        document.getElementById('bet-details').innerText = "";

        setTimeout(() => {
            rewards.win = Math.floor(Math.random() * (item.max - item.min + 1)) + item.min;
            rewards.lose = 1;
            document.getElementById('dialogue').innerText = `"${item.reactions[0]}"`;
            document.getElementById('bet-details').innerHTML = `성공 시: ${rewards.win} COINS | 실패 시: ${rewards.lose} COIN`;
            document.getElementById('main-btn').disabled = false;
            document.getElementById('main-btn').innerText = "야바위 수락";
            document.getElementById('main-btn').onclick = startGame;
        }, 1200);
    }

    function startGame() {
        playing = true; finished = false;
        document.getElementById('main-btn').disabled = true;
        document.getElementById('dialogue').innerText = "눈 떼지 마라! 시작한다.";

        coinPos = Math.floor(Math.random() * 3);
        document.querySelectorAll('.coin-stack').forEach(s => { s.innerHTML = ''; s.classList.remove('visible'); });
        document.querySelectorAll('.cup-slot').forEach(s => s.classList.remove('lifted'));

        const target = document.getElementById(`coins-${coinPos}`);
        target.innerHTML = '<div class="dot-coin"></div>';

        setTimeout(() => {
            document.getElementById(`slot-${coinPos}`).classList.add('lifted');
            target.classList.add('visible');
            setTimeout(() => {
                document.getElementById(`slot-${coinPos}`).classList.remove('lifted');
                setTimeout(() => { target.classList.remove('visible'); shuffle(); }, 600);
            }, 1000);
        }, 500);
    }

    function shuffle() {
        let moves = 0;
        const interval = setInterval(() => {
            let a = Math.floor(Math.random() * 3); let b = Math.floor(Math.random() * 3);
            while(a === b) b = Math.floor(Math.random() * 3);
            const sA = document.getElementById(`slot-${a}`); const sB = document.getElementById(`slot-${b}`);
            const tempL = sA.style.left; sA.style.left = sB.style.left; sB.style.left = tempL;
            if (coinPos === a) coinPos = b; else if (coinPos === b) coinPos = a;
            moves++;
            if (moves > 12) { clearInterval(interval); playing = false; document.getElementById('dialogue').innerText = "자, 어느 컵인가?"; }
        }, 400);
    }

    function handleSelect(id) {
        if (playing || finished) return;
        finished = true;
        document.getElementById(`slot-${id}`).classList.add('lifted');
        
        if (id === coinPos) {
            document.getElementById(`coins-${id}`).classList.add('visible');
            coins += rewards.win;
            document.getElementById('dialogue').innerText = `"제대로 골랐군. 여기 ${rewards.win}코인이다."`;
        } else {
            coins += rewards.lose;
            document.getElementById('dialogue').innerText = `"틀렸어! 이건 짝퉁이니 ${rewards.lose}코인만 받게."`;
            setTimeout(() => {
                document.getElementById(`slot-${coinPos}`).classList.add('lifted');
                document.getElementById(`coins-${coinPos}`).classList.add('visible');
            }, 500);
        }
        document.getElementById('balance').innerText = `${coins} COINS`;
        document.getElementById('main-btn').disabled = false;
        document.getElementById('main-btn').innerText = "다른 아이템 찾기";
        document.getElementById('main-btn').onclick = triggerAppraisal;
    }
</script>
</body>
</html>
