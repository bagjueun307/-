<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Black Market Pawn Shop</title>
    <style>
        :root { 
            --gold: #ffd700; --legendary: #ff8000; --epic: #a335ee; 
            --rare: #0070dd; --uncommon: #1eff00; --common: #9d9d9d; 
        }
        * { image-rendering: pixelated; box-sizing: border-box; font-family: 'Malgun Gothic', sans-serif; }
        
        body {
            margin: 0; height: 100vh;
            background: #0a0a0b url('https://github.com/bagjueun307/-/blob/main/%EC%A0%84%EC%B2%B4.png?raw=true') no-repeat center center;
            background-size: cover; display: flex; flex-direction: column; align-items: center; overflow: hidden;
        }

        /* [핵심 수정] 팝업 크기를 슬림하게 줄이고 상단으로 밀착 */
        .ui-container {
            position: absolute; top: 20px; width: 580px;
            background: rgba(255, 255, 255, 0.7); /* 투명도 상향 */
            backdrop-filter: blur(5px);
            border: 4px solid #222; padding: 15px 25px; color: #111;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.5); z-index: 100;
            border-radius: 8px;
        }

        .balance-badge {
            position: absolute; top: 10px; right: -80px; /* 위치 조정 */
            background: #222; color: var(--gold); padding: 8px 15px;
            border: 3px solid var(--gold); font-size: 20px; font-weight: 900;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.3);
        }

        /* 대사창 크기 축소 */
        #dialogue { font-size: 18px; font-weight: 700; min-height: 40px; margin-bottom: 10px; }

        /* [변경] 상품 이름과 등급을 한 줄에 배치하여 높이 절약 */
        #item-info { 
            display: none; padding: 10px; background: rgba(0, 0, 0, 0.85); color: white;
            border: 2px solid #444; border-radius: 5px; margin-bottom: 10px;
        }
        
        .info-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .tier-kor { font-size: 24px; font-weight: 900; }
        .stars { font-size: 18px; color: var(--gold); letter-spacing: 2px; }
        .item-name-display { font-size: 22px; font-weight: bold; color: #fff; border-bottom: 2px solid var(--gold); }
        .value-text { font-size: 18px; font-weight: bold; color: var(--gold); }

        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 10px; border: 3px solid #111; cursor: pointer; font-size: 16px; font-weight: bold; border-radius: 4px; }
        .btn-accept { background: #222; color: #fff; }

        /* [야바위 구역] 컵이 주인공이 되도록 영역 확보 */
        .game-zone { 
            position: absolute; bottom: 5%; width: 1000px; height: 400px; 
            display: flex; justify-content: center;
        }

        .cup {
            position: absolute; bottom: 0; width: 300px; height: 350px;
            background: url('https://github.com/bagjueun307/-/blob/main/%EC%BB%B5%20%EC%97%8E%EC%9D%80%20%ED%98%95%ED%83%9C%20%EC%9D%B4%EB%AF%B8%EC%A7%80.png?raw=true') no-repeat center center;
            background-size: contain; 
            transition: left 0.35s ease-in-out, transform 0.4s ease; 
            cursor: pointer; z-index: 10;
        }

        .cup.lifted {
            background-image: url('https://github.com/bagjueun307/-/blob/main/%EC%9C%84%EB%A1%9C%20%ED%96%A5%ED%95%9C%20%EC%BB%B5%20%EC%9D%B4%EB%AF%B8%EC%A7%80.png?raw=true');
            transform: translateY(-180px);
        }

        .coin-stack { 
            position: absolute; bottom: 30px; 
            width: 280px; height: 280px; display: none; justify-content: center; z-index: 5;
            transition: left 0.35s ease-in-out;
        }
        .coin-stack.visible { display: flex; }
        
        .pixel-coin {
            width: 250px; height: 250px;
            background: url('https://github.com/bagjueun307/-/blob/main/%EC%BD%94%EC%9D%B8%20%EC%9D%B4%EB%AF%B8%EC%A7%80%20%EC%A0%95%EC%B8%A1%EB%A9%B4.png?raw=true') no-repeat center center;
            background-size: contain;
        }
    </style>
</head>
<body>

    <div class="ui-container">
        <div class="balance-badge" id="balance-display">코인: 0</div>
        <div id="dialogue">"물건부터 꺼내봐. 감정 후에 판돈을 정하지."</div>
        
        <div id="item-info">
            <div class="info-row">
                <span id="tier-kor" class="tier-kor">전설 등급</span>
                <span id="stars" class="stars">★★★★★</span>
            </div>
            <div class="info-row">
                <span id="item-name" class="item-name-display">품명 정보 없음</span>
                <span class="value-text"><span id="item-val">0</span> 코인</span>
            </div>
        </div>

        <div class="btn-group">
            <button id="btn-main" class="btn-accept" onclick="startAppraisal()">물건 꺼내기</button>
        </div>
    </div>

    <div class="game-zone">
        <div id="slot-0" class="cup" style="left: 0px;" onclick="select(0)"></div>
        <div id="slot-1" class="cup" style="left: 340px;" onclick="select(1)"></div>
        <div id="slot-2" class="cup" style="left: 680px;" onclick="select(2)"></div>
        
        <div id="stack-0" class="coin-stack" style="left: 0px;"><div class="pixel-coin"></div></div>
        <div id="stack-1" class="coin-stack" style="left: 340px;"><div class="pixel-coin"></div></div>
        <div id="stack-2" class="coin-stack" style="left: 680px;"><div class="pixel-coin"></div></div>
    </div>

<script>
    let wallet = 0; let playing = false; let finished = true; let coinPos = 1; let currentVal = 0;

    const tiers = {
        LEGENDARY: { kor: "전설 등급", stars: "★★★★★", color: "#ff8000", value: 10, msg: "세상에... 이건 전설의 보물이야!" },
        EPIC:      { kor: "에픽 등급", stars: "★★★★☆", color: "#a335ee", value: 7, msg: "귀한 유물을 가져왔구만." },
        RARE:      { kor: "희귀 등급", stars: "★★★☆☆", color: "#0070dd", value: 5, msg: "제법 돈이 되겠어." },
        UNCOMMON:  { kor: "상급 등급", stars: "★★☆☆☆", color: "#1eff00", value: 3, msg: "쓸만한 물건이군." },
        COMMON:    { kor: "일반 등급", stars: "★☆☆☆☆", color: "#9d9d9d", value: 1, msg: "흔한 장물이구만." }
    };

    const itemList = ["낡은 장부", "녹슨 메달", "수상한 병", "먼지 쌓인 반지", "깨진 거울", "황금 열쇠", "오래된 지도"];

    function startAppraisal() {
        if(playing) return;
        const diag = document.getElementById('dialogue');
        document.getElementById('item-info').style.display = 'none';
        
        const thoughts = ["오.. 이게 뭐지...?", "흠.... 이거 본 거 같기도..", "아! 알겠다!"];
        let i = 0;
        const thinkingInterval = setInterval(() => {
            if(i < thoughts.length) diag.innerText = thoughts[i++];
            else { clearInterval(thinkingInterval); finishAppraisal(); }
        }, 500);
    }

    function finishAppraisal() {
        const rand = Math.random();
        let tierKey = (rand < 0.05) ? "LEGENDARY" : (rand < 0.15) ? "EPIC" : (rand < 0.35) ? "RARE" : (rand < 0.65) ? "UNCOMMON" : "COMMON";
        const tier = tiers[tierKey];
        currentVal = tier.value;
        
        document.getElementById('tier-kor').innerText = tier.kor;
        document.getElementById('tier-kor').style.color = tier.color;
        document.getElementById('stars').innerText = tier.stars;
        document.getElementById('item-name').innerText = itemList[Math.floor(Math.random()*itemList.length)];
        document.getElementById('item-val').innerText = currentVal;
        
        document.getElementById('item-info').style.display = 'block';
        document.getElementById('dialogue').innerText = `"${tier.msg}"`;
        
        const btn = document.getElementById('btn-main');
        btn.innerText = "야바위 수락";
        btn.onclick = startShuffle;
    }

    function startShuffle() {
        playing = true; finished = false;
        document.querySelectorAll('.coin-stack').forEach(s => s.classList.remove('visible'));
        
        coinPos = Math.floor(Math.random()*3);
        document.getElementById(`slot-${coinPos}`).classList.add('lifted');
        document.getElementById(`stack-${coinPos}`).classList.add('visible');

        setTimeout(() => {
            document.getElementById(`slot-${coinPos}`).classList.remove('lifted');
            setTimeout(() => { 
                document.getElementById(`stack-${coinPos}`).classList.remove('visible');
                performShuffle(0, 15);
            }, 600);
        }, 1000);
    }

    function performShuffle(count, total) {
        if(count >= total) {
            playing = false;
            document.getElementById('dialogue').innerText = "자... 어디에 들었지? 골라봐!";
            return;
        }
        let a = Math.floor(Math.random()*3), b = Math.floor(Math.random()*3);
        while(a === b) b = Math.floor(Math.random()*3);

        const cupA = document.getElementById(`slot-${a}`), cupB = document.getElementById(`slot-${b}`);
        const stackA = document.getElementById(`stack-${a}`), stackB = document.getElementById(`stack-${b}`);

        const tempLeft = cupA.style.left;
        cupA.style.left = cupB.style.left;
        cupB.style.left = tempLeft;
        stackA.style.left = stackB.style.left;
        stackB.style.left = tempLeft;

        setTimeout(() => performShuffle(count + 1, total), 350);
    }

    function select(id) {
        if(playing || finished) return;
        finished = true;
        for(let i=0; i<3; i++) document.getElementById(`slot-${i}`).classList.add('lifted');
        document.getElementById(`stack-${coinPos}`).classList.add('visible');

        const selectedCupLeft = document.getElementById(`slot-${id}`).style.left;
        const answerStackLeft = document.getElementById(`stack-${coinPos}`).style.left;

        if(selectedCupLeft === answerStackLeft) {
            wallet += currentVal;
            document.getElementById('dialogue').innerText = "정답이야! 여기 코인 받게나.";
        } else {
            document.getElementById('dialogue').innerText = "땡! 아쉽지만 이건 내 거야.";
        }

        document.getElementById('balance-display').innerText = `코인: ${wallet}`;
        setTimeout(() => {
            document.getElementById('btn-main').innerText = "다른 물건 꺼내기";
            document.getElementById('btn-main').onclick = startAppraisal;
        }, 2000);
    }
</script>
</body>
</html>
