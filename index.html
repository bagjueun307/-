<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Secret Pawn Shop: Appraisal</title>
    <style>
        * { image-rendering: pixelated; box-sizing: border-box; cursor: crosshair; }
        body {
            margin: 0; height: 100vh;
            background: #0a0a0a url('background.png') no-repeat center center;
            background-size: cover;
            display: flex; justify-content: space-between; align-items: flex-end;
            font-family: 'Courier New', monospace; color: #eee;
            overflow: hidden; padding: 40px;
        }

        /* UI 패널 스타일 */
        .side-panel, .control-panel {
            width: 280px; height: 450px;
            background: rgba(15, 15, 15, 0.95);
            border: 4px solid #5d3a1a; padding: 20px;
            display: flex; flex-direction: column;
            box-shadow: 10px 10px 0px #000;
            z-index: 10;
        }

        .game-board {
            position: absolute; left: 50%; bottom: 12%;
            transform: translateX(-50%);
            width: 600px; height: 200px;
        }

        /* 아이템 등급별 색상 */
        .rarity-common { color: #aaa; }
        .rarity-rare { color: #4facfe; text-shadow: 0 0 5px #000; }
        .rarity-legendary { color: #f9d423; text-shadow: 0 0 10px #f9d423; font-weight: bold; animation: blink 1s infinite; }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }

        /* 컵 및 코인 디자인 */
        .cup-slot { position: absolute; width: 100px; height: 120px; transition: all 0.4s cubic-bezier(0.5, 0, 0.5, 1); display: flex; justify-content: center; align-items: flex-end; }
        .cup-pixel { width: 80px; height: 100px; background: #8b5a2b; border: 4px solid #3e2712; border-radius: 10px 10px 30px 30px; z-index: 2; transition: transform 0.4s ease-out; position: relative; }
        .cup-pixel::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 8px; background: #a67c52; border-bottom: 3px solid #3e2712; }
        .lifted .cup-pixel { transform: translateY(-80px) rotate(-10deg); }
        .coin-stack { position: absolute; bottom: 10px; display: none; z-index: 1; }
        .coin-stack.visible { display: flex; flex-direction: column-reverse; }
        .dot-coin { width: 34px; height: 10px; background: #ffd700; border: 2px solid #b8860b; margin-bottom: -5px; }

        /* 버튼 및 텍스트 */
        .label { color: #888; font-size: 0.75rem; margin-bottom: 5px; }
        .value { color: #ffd700; font-size: 1.5rem; margin-bottom: 20px; }
        .item-display-box { background: #000; border: 2px inset #5d3a1a; padding: 15px; min-height: 100px; text-align: center; }
        
        button {
            background: #e63946; color: white; border: none; padding: 18px;
            font-family: inherit; font-weight: bold; font-size: 1rem;
            cursor: pointer; border-bottom: 6px solid #9d2630;
        }
        button:active { border-bottom: none; transform: translateY(6px); }
        button:disabled { background: #333; border-bottom-color: #222; color: #777; }

        #dialogue { font-size: 0.9rem; line-height: 1.5; color: #fff; min-height: 80px; }
    </style>
</head>
<body>

    <div class="side-panel">
        <div class="label">PURSE</div>
        <div id="balance" class="value">0 COINS</div>
        
        <div class="label">INSPECTION RESULT</div>
        <div class="item-display-box">
            <div id="item-rarity" style="font-size: 0.7rem; margin-bottom: 5px;"></div>
            <div id="item-name" style="font-size: 1.1rem;">- No Item -</div>
        </div>
        <div id="bet-details" style="margin-top: 15px; font-size: 0.8rem; color: #ffd700;"></div>
    </div>

    <div class="game-board">
        <div class="cup-slot" id="slot-0" style="left: 50px;" onclick="handleSelect(0)">
            <div class="cup-pixel"></div>
            <div id="coins-0" class="coin-stack"></div>
        </div>
        <div class="cup-slot" id="slot-1" style="left: 250px;" onclick="handleSelect(1)">
            <div class="cup-pixel"></div>
            <div id="coins-1" class="coin-stack"></div>
        </div>
        <div class="cup-slot" id="slot-2" style="left: 450px;" onclick="handleSelect(2)">
            <div class="cup-pixel"></div>
            <div id="coins-2" class="coin-stack"></div>
        </div>
    </div>

    <div class="control-panel" style="justify-content: space-between;">
        <div>
            <div class="label">DEALER</div>
            <div id="dialogue">"가방 안에 든 게 뭐야? 돈이 될만한 거면 꺼내봐."</div>
        </div>
        <button id="main-btn" onclick="triggerAppraisal()">아이템 꺼내기</button>
    </div>

<script>
    let coins = 0;
    let playing = false;
    let finished = true;
    let coinPos = 1;
    let rewards = { win: 0, lose: 0 };

    const lootTable = [
        { name: "녹슨 캔따개", rarity: "COMMON", min: 1, max: 3, reactions: ["이런 쓰레기를 왜 나한테 가져와?", "이건 줘도 안 가져가."] },
        { name: "낡은 명품 지갑", rarity: "RARE", min: 10, max: 25, reactions: ["오... 이건 꽤 상태가 괜찮은데?", "진품이군. 좋은 값을 쳐줄 수도 있겠어."] },
        { name: "왕관 보석", rarity: "LEGENDARY", min: 50, max: 150, reactions: ["세상에... 이건 말도 안 돼!", "이걸 어디서 구했나?! 자네, 목숨 걸 준비는 됐겠지?"] },
        { name: "골드바", rarity: "RARE", min: 20, max: 40, reactions: ["묵직하군. 아주 마음에 들어.", "금은 언제나 환영이지."] }
    ];

    function triggerAppraisal() {
        if (playing) return;
        const item = lootTable[Math.floor(Math.random() * lootTable.length)];
        
        // UI 업데이트
        const rarityEl = document.getElementById('item-rarity');
        rarityEl.innerText = `[ ${item.rarity} ]`;
        rarityEl.className = `rarity-${item.rarity.toLowerCase()}`;
        document.getElementById('item-name').innerText = item.name;
        document.getElementById('dialogue').innerText = `"${item.reactions[Math.floor(Math.random()*item.reactions.length)]}"`;
        
        document.getElementById('main-btn').disabled = true;
        document.getElementById('bet-details').innerText = "감정 중...";

        setTimeout(() => {
            // 희귀도에 따라 보상 폭 결정
            rewards.win = Math.floor(Math.random() * (item.max - item.min + 1)) + item.min;
            rewards.lose = Math.max(1, Math.floor(rewards.win * 0.2)); // 실패 시 20%만 지급

            document.getElementById('bet-details').innerHTML = `성공 시: <span style="color:#4ade80">${rewards.win}</span><br>실패 시: <span style="color:#f87171">${rewards.lose}</span>`;
            document.getElementById('main-btn').disabled = false;
            document.getElementById('main-btn').innerText = "야바위 수락";
            document.getElementById('main-btn').onclick = startGame;
        }, 1200);
    }

    function startGame() {
        playing = true; finished = false;
        document.getElementById('main-btn').disabled = true;
        document.getElementById('dialogue').innerText = "자... 눈 떼지 마라. 물건값 제대로 받고 싶으면!";

        coinPos = Math.floor(Math.random() * 3);
        document.querySelectorAll('.coin-stack').forEach(s => { s.innerHTML = ''; s.classList.remove('visible'); });
        document.querySelectorAll('.cup-slot').forEach(s => s.classList.remove('lifted'));

        const target = document.getElementById(`coins-${coinPos}`);
        target.innerHTML = '<div class="dot-coin"></div>';

        setTimeout(() => {
            document.getElementById(`slot-${coinPos}`).classList.add('lifted');
            target.classList.add('visible');
            setTimeout(() => {
                document.getElementById(`slot-${coinPos}`).classList.remove('lifted');
                setTimeout(() => { target.classList.remove('visible'); shuffle(); }, 600);
            }, 1000);
        }, 500);
    }

    function shuffle() {
        let moves = 0;
        const interval = setInterval(() => {
            let a = Math.floor(Math.random() * 3); let b = Math.floor(Math.random() * 3);
            while(a === b) b = Math.floor(Math.random() * 3);
            const sA = document.getElementById(`slot-${a}`); const sB = document.getElementById(`slot-${b}`);
            const tempL = sA.style.left; sA.style.left = sB.style.left; sB.style.left = tempL;
            if (coinPos === a) coinPos = b; else if (coinPos === b) coinPos = a;
            moves++;
            if (moves > 12) {
                clearInterval(interval);
                playing = false;
                document.getElementById('dialogue').innerText = "어디에 있지? 제대로 고르면 제값을 쳐주마.";
            }
        }, 400);
    }

    function handleSelect(id) {
        if (playing || finished) return;
        finished = true;
        document.getElementById(`slot-${id}`).classList.add('lifted');
        
        if (id === coinPos) {
            document.getElementById(`coins-${id}`).classList.add('visible');
            coins += rewards.win;
            document.getElementById('dialogue').innerText = `"호오, 이걸 맞추다니. 여기 약속한 ${rewards.win}코인이다."`;
        } else {
            coins += rewards.lose;
            document.getElementById('dialogue').innerText = `"틀렸어! 짝퉁이 분명해. ${rewards.lose}코인이나 받아가."`;
            setTimeout(() => {
                document.getElementById(`slot-${coinPos}`).classList.add('lifted');
                document.getElementById(`coins-${coinPos}`).classList.add('visible');
            }, 500);
        }

        document.getElementById('balance').innerText = `${coins} COINS`;
        document.getElementById('main-btn').disabled = false;
        document.getElementById('main-btn').innerText = "다른 물건 꺼내기";
        document.getElementById('main-btn').onclick = triggerAppraisal;
    }
</script>
</body>
</html>
