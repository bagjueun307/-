<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury Pawn Shop Gamble</title>
    <style>
        * { image-rendering: pixelated; box-sizing: border-box; }
        body {
            margin: 0; height: 100vh;
            background: #111 url('background.png') no-repeat center center;
            background-size: cover;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            font-family: 'Courier New', monospace; color: #fff;
        }

        /* 통계 및 아이템 창 */
        .stats {
            position: absolute; top: 20px; left: 20px;
            background: rgba(0, 0, 0, 0.9); border: 4px solid #ffd700;
            padding: 15px; box-shadow: 4px 4px 0px #000; width: 200px;
        }
        .debt-text { color: #ff4d4d; font-weight: bold; }

        .ui-header {
            position: absolute; top: 30px; background: rgba(0, 0, 0, 0.85);
            border: 4px solid #fff; padding: 20px; text-align: center; width: 550px; min-height: 180px;
        }

        .game-board { position: relative; width: 600px; height: 300px; margin-top: 180px; }

        /* 컵 및 코인 스타일 (기존 유지) */
        .cup-slot { position: absolute; width: 100px; height: 120px; transition: all 0.4s ease-in-out; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .cup-pixel { width: 80px; height: 100px; background: #8b5a2b; border: 4px solid #3e2712; border-radius: 10px 10px 40px 40px; position: relative; z-index: 2; transition: transform 0.4s; }
        .cup-pixel::before { content: ''; position: absolute; top: -5px; left: 10%; width: 80%; height: 10px; background: #a67c52; border: 3px solid #3e2712; border-radius: 50%; }
        .cup-slot.lifted .cup-pixel { transform: translateY(-80px) rotate(-15deg); }
        .coin-stack { position: absolute; bottom: 5px; display: none; flex-direction: column-reverse; z-index: 1; }
        .coin-stack.visible { display: flex; }
        .dot-coin { width: 34px; height: 10px; background: #ffd700; border: 2px solid #b8860b; border-radius: 4px; margin-bottom: -6px; }

        button { margin-top: 15px; padding: 12px 24px; background: #ff4d4d; color: #fff; border: 4px solid #fff; cursor: pointer; font-family: inherit; font-weight: bold; }
        button:disabled { background: #555; }
    </style>
</head>
<body>

<div class="stats">
    <div style="color: #ffd700; font-size: 0.8rem;">내 소지금</div>
    <div id="my-coins" style="font-size: 1.5rem; margin-bottom: 10px;">10 COINS</div>
    <div id="debt-info" class="debt-text">빚: 0 COINS</div>
    <hr style="border: 1px solid #444;">
    <div style="font-size: 0.7rem; color: #aaa;">가방 안의 분실물</div>
    <div id="item-name" style="font-size: 0.9rem; color: #4ade80;">- 없음 -</div>
</div>

<div class="ui-header">
    <div id="status-msg">"전당포 문 열었네. 뭐 좀 가져온 거 있나?"</div>
    <div id="appraisal-box" style="margin: 10px 0; font-size: 0.9rem; color: #ffd700;"></div>
    <button id="action-btn" onclick="presentItem()">분실물 꺼내기</button>
</div>

<div class="game-board">
    <div class="cup-slot" id="slot-0" style="left: 50px; bottom: 50px;" onclick="selectCup(0)">
        <div class="cup-pixel"></div>
        <div class="coin-stack" id="coins-0"></div>
    </div>
    <div class="cup-slot" id="slot-1" style="left: 250px; bottom: 50px;" onclick="selectCup(1)">
        <div class="cup-pixel"></div>
        <div class="coin-stack" id="coins-1"></div>
    </div>
    <div class="cup-slot" id="slot-2" style="left: 450px; bottom: 50px;" onclick="selectCup(2)">
        <div class="cup-pixel"></div>
        <div class="coin-stack" id="coins-2"></div>
    </div>
</div>

<script>
    let userBalance = 10; 
    let debt = 0;
    let winReward = 0;
    let lossPenalty = 0;
    let coinPos = 1;
    let playing = false;
    let finished = true;

    // 명품 분실물 목록
    const luxuryItems = [
        { name: "녹슨 롤렉스 시계", min: 5, max: 10, msg: "오호, 굴러다니던 것 치곤 상태가 나쁘지 않군." },
        { name: "에르메스 스카프", min: 3, max: 7, msg: "진품이라면 꽤 나갈 텐데... 어디 보자." },
        { name: "구찌 지갑(빈 것)", min: 2, max: 5, msg: "지갑만 있군. 그래도 가죽은 쓸만해." },
        { name: "다이아몬드 반지", min: 8, max: 15, msg: "이건...! 어디서 훔친 건 아니겠지?" },
        { name: "금니 3개", min: 4, max: 8, msg: "누구 건진 몰라도 꽤 묵직하군." }
    ];

    function updateStats() {
        if (userBalance < 0) { debt += Math.abs(userBalance); userBalance = 0; }
        document.getElementById('my-coins').innerText = `${userBalance} COINS`;
        document.getElementById('debt-info').innerText = `빚: ${debt} COINS`;
        if (debt >= 100) {
            document.getElementById('status-msg').innerText = "이봐, 이미 늦었어. 여길 벗어날 생각 마.";
            document.getElementById('action-btn').disabled = true;
        }
    }

    // 아이템 제시 및 감정
    function presentItem() {
        if (playing) return;
        
        const item = luxuryItems[Math.floor(Math.random() * luxuryItems.length)];
        document.getElementById('item-name').innerText = item.name;
        document.getElementById('status-msg').innerText = `"${item.msg}"`;
        
        // 감정 시작 연출
        document.getElementById('appraisal-box').innerText = "감정 중...";
        document.getElementById('action-btn').disabled = true;

        setTimeout(() => {
            winReward = Math.floor(Math.random() * (item.max - item.min + 1)) + item.min;
            lossPenalty = Math.floor(winReward * 1.5); // 사장은 무조건 1.5배의 리스크를 요구함
            
            document.getElementById('appraisal-box').innerText = `[감정가: 이기면 ${winReward} / 지면 -${lossPenalty}]`;
            document.getElementById('status-msg').innerText = `"자, 이 물건을 담보로 한 판 어때?"`;
            document.getElementById('action-btn').disabled = false;
            document.getElementById('action-btn').innerText = "승낙하고 게임 시작";
            document.getElementById('action-btn').onclick = startBet;
        }, 1500);
    }

    function startBet() {
        playing = true; finished = false;
        document.getElementById('action-btn').disabled = true;
        document.getElementById('status-msg').innerText = "눈 떼지 마라, 시작한다!";

        coinPos = Math.floor(Math.random() * 3);
        document.querySelectorAll('.coin-stack').forEach(s => { s.innerHTML = ''; s.classList.remove('visible'); });
        document.querySelectorAll('.cup-slot').forEach(s => s.classList.remove('lifted'));

        const target = document.getElementById(`coins-${coinPos}`);
        target.innerHTML = '<div class="dot-coin"></div>';

        setTimeout(() => {
            document.getElementById(`slot-${coinPos}`).classList.add('lifted');
            target.classList.add('visible');
            setTimeout(() => {
                document.getElementById(`slot-${coinPos}`).classList.remove('lifted');
                setTimeout(() => { target.classList.remove('visible'); shuffle(); }, 600);
            }, 1000);
        }, 800);
    }

    function shuffle() {
        let count = 0; const total = 14;
        const timer = setInterval(() => {
            let a = Math.floor(Math.random() * 3); let b = Math.floor(Math.random() * 3);
            while(a === b) b = Math.floor(Math.random() * 3);
            const sA = document.getElementById(`slot-${a}`); const sB = document.getElementById(`slot-${b}`);
            const tempLeft = sA.style.left; sA.style.left = sB.style.left; sB.style.left = tempLeft;
            if (coinPos === a) coinPos = b; else if (coinPos === b) coinPos = a;
            count++;
            if(count >= total) {
                clearInterval(timer); playing = false;
                document.getElementById('status-msg').innerText = "어디에 걸겠나?";
            }
        }, 380);
    }

    function selectCup(id) {
        if (playing || finished) return;
        finished = true;
        document.getElementById(`slot-${id}`).classList.add('lifted');

        if(id === coinPos) {
            document.getElementById(`coins-${id}`).classList.add('visible');
            if (debt > 0) {
                let pay = Math.min(debt, winReward);
                debt -= pay; userBalance += (winReward - pay);
            } else { userBalance += winReward; }
            document.getElementById('status-msg').innerHTML = `<span style='color:#4ade80'>운이 좋군. 물건값으로 ${winReward}코인 주지.</span>`;
        } else {
            userBalance -= lossPenalty;
            document.getElementById('status-msg').innerHTML = `<span style='color:#ff4d4d'>멍청하긴! ${lossPenalty}코인 적립이다!</span>`;
            setTimeout(() => {
                document.getElementById(`slot-${coinPos}`).classList.add('lifted');
                document.getElementById(`coins-${coinPos}`).classList.add('visible');
            }, 500);
        }
        
        updateStats();
        document.getElementById('action-btn').disabled = (debt >= 100);
        document.getElementById('action-btn').innerText = "다른 물건 꺼내기";
        document.getElementById('action-btn').onclick = presentItem;
        document.getElementById('appraisal-box').innerText = "";
    }

    updateStats();
</script>

</body>
</html>
