<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Black Market Pawn Shop - Giant Edition</title>
    <style>
        :root { 
            --gold: #ffd700; --legendary: #ff8000; --epic: #a335ee; 
            --rare: #0070dd; --uncommon: #1eff00; --common: #9d9d9d; 
        }
        * { image-rendering: pixelated; box-sizing: border-box; font-family: 'Malgun Gothic', sans-serif; }
        
        body {
            margin: 0; height: 100vh;
            background: #0a0a0b url('https://github.com/bagjueun307/-/blob/main/%EC%A0%84%EC%B2%B4.png?raw=true') no-repeat center center;
            background-size: cover; display: flex; flex-direction: column; align-items: center; overflow: hidden;
        }

        /* UI 위치 조정 (너무 위로 붙지 않게) */
        .ui-container {
            position: absolute; top: 60px; width: 650px;
            background: rgba(255, 255, 255, 0.8); 
            backdrop-filter: blur(8px);
            border: 5px solid #222; padding: 20px; color: #111;
            box-shadow: 15px 15px 0px rgba(0,0,0,0.5); z-index: 100;
            border-radius: 12px;
        }

        .balance-badge {
            position: absolute; top: -20px; right: -20px;
            background: #222; color: var(--gold); padding: 10px 20px;
            border: 4px solid var(--gold); font-size: 24px; font-weight: 900;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.3); transform: rotate(2deg);
        }

        #dialogue { font-size: 20px; font-weight: 700; min-height: 50px; margin-bottom: 10px; border-bottom: 2px dashed #999; padding-bottom: 10px; }

        #item-info { 
            display: none; padding: 15px; background: rgba(0, 0, 0, 0.9); color: white;
            border-radius: 8px; margin-bottom: 10px;
        }
        
        .info-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .tier-kor { font-size: 28px; font-weight: 900; }
        .stars { font-size: 22px; color: var(--gold); letter-spacing: 3px; }
        .item-name-display { font-size: 24px; font-weight: bold; color: #fff; text-decoration: underline var(--gold); }
        .value-text { font-size: 20px; font-weight: bold; color: var(--gold); }

        button { width: 100%; padding: 15px; border: 4px solid #111; cursor: pointer; font-size: 22px; font-weight: bold; border-radius: 6px; background: #222; color: #fff; }
        button:hover { background: #444; }

        /* [핵심] 컵과 코인 크기 대폭 확대 (2000%급 스케일 체감) */
        .game-zone { 
            position: absolute; bottom: 0%; width: 1200px; height: 600px; 
            display: flex; justify-content: center; pointer-events: none;
        }

        .cup {
            position: absolute; bottom: 20px; width: 450px; height: 550px; /* 기존보다 훨씬 거대해짐 */
            background: url('https://github.com/bagjueun307/-/blob/main/%EC%BB%B5%20%EC%97%8E%EC%9D%80%20%ED%98%95%ED%83%9C%20%EC%9D%B4%EB%AF%B8%EC%A7%80.png?raw=true') no-repeat center center;
            background-size: contain; 
            transition: left 0.3s ease-in-out, transform 0.4s ease; 
            cursor: pointer; z-index: 10; pointer-events: auto;
        }

        /* 컵이 들릴 때 이미지 원상복귀를 위해 클래스 분리 */
        .cup.lifted {
            background-image: url('https://github.com/bagjueun307/-/blob/main/%EC%9C%84%EB%A1%9C%20%ED%96%A5%ED%95%9C%20%EC%BB%B5%20%EC%9D%B4%EB%AF%B8%EC%A7%80.png?raw=true') !important;
            transform: translateY(-250px);
        }

        .coin-stack { 
            position: absolute; bottom: 50px; 
            width: 400px; height: 400px; display: none; justify-content: center; z-index: 5;
            transition: left 0.3s ease-in-out;
        }
        .coin-stack.visible { display: flex; }
        
        .pixel-coin {
            width: 380px; height: 380px; /* 코인도 화면의 절반 가까이 차지 */
            background: url('https://github.com/bagjueun307/-/blob/main/%EC%BD%94%EC%9D%B8%20%EC%9D%B4%EB%AF%B8%EC%A7%80%20%EC%A0%95%EC%B8%A1%EB%A9%B4.png?raw=true') no-repeat center center;
            background-size: contain;
        }
    </style>
</head>
<body>

    <div class="ui-container">
        <div class="balance-badge" id="balance-display">보유 코인: 0</div>
        <div id="dialogue">"가져온 물건을 테이블 위에 올려보게."</div>
        
        <div id="item-info">
            <div class="info-row">
                <span id="tier-kor" class="tier-kor">전설 등급</span>
                <span id="stars" class="stars">★★★★★</span>
            </div>
            <div class="info-row">
                <span id="item-name" class="item-name-display">아이템명</span>
                <span class="value-text"><span id="item-val">0</span> 코인</span>
            </div>
        </div>

        <button id="btn-main" onclick="startAppraisal()">물건 꺼내기</button>
    </div>

    <div class="game-zone">
        <div id="slot-0" class="cup" style="left: -50px;" onclick="select(0)"></div>
        <div id="slot-1" class="cup" style="left: 375px;" onclick="select(1)"></div>
        <div id="slot-2" class="cup" style="left: 800px;" onclick="select(2)"></div>
        
        <div id="stack-0" class="coin-stack" style="left: -50px;"><div class="pixel-coin"></div></div>
        <div id="stack-1" class="coin-stack" style="left: 375px;"><div class="pixel-coin"></div></div>
        <div id="stack-2" class="coin-stack" style="left: 800px;"><div class="pixel-coin"></div></div>
    </div>

<script>
    let wallet = 0; let playing = false; let finished = true; let coinPos = 1; let currentVal = 0;
    const defaultPositions = ["-50px", "375px", "800px"];

    const tiers = {
        LEGENDARY: { kor: "전설 등급", stars: "★★★★★", color: "#ff8000", value: 10, msg: "세상에... 이건 전설의 보물이야!" },
        EPIC:      { kor: "에픽 등급", stars: "★★★★☆", color: "#a335ee", value: 7, msg: "귀한 유물을 가져왔구만." },
        RARE:      { kor: "희귀 등급", stars: "★★★☆☆", color: "#0070dd", value: 5, msg: "제법 돈이 되겠어." },
        UNCOMMON:  { kor: "상급 등급", stars: "★★☆☆☆", color: "#1eff00", value: 3, msg: "쓸만한 물건이군." },
        COMMON:    { kor: "일반 등급", stars: "★☆☆☆☆", color: "#9d9d9d", value: 1, msg: "흔한 장물이구만." }
    };

    const itemList = ["낡은 장부", "녹슨 메달", "수상한 병", "먼지 쌓인 반지", "황금 열쇠", "오래된 지도"];

    // [초기화 로직] 모든 상태를 게임 시작 전으로 원상 복구
    function resetGame() {
        finished = true;
        playing = false;
        document.querySelectorAll('.cup').forEach((cup, idx) => {
            cup.classList.remove('lifted');
            cup.style.left = defaultPositions[idx]; // 컵 위치 초기화
        });
        document.querySelectorAll('.coin-stack').forEach((stack, idx) => {
            stack.classList.remove('visible');
            stack.style.left = defaultPositions[idx]; // 코인 위치 초기화
        });
    }

    function startAppraisal() {
        if(playing) return;
        resetGame(); // 감정 시작 시 이전 판 상태 청소
        
        const diag = document.getElementById('dialogue');
        document.getElementById('item-info').style.display = 'none';
        
        const thoughts = ["오.. 이게 뭐지...?", "흠.... 이거 본 거 같기도..", "아! 알겠다!"];
        let i = 0;
        const thinkingInterval = setInterval(() => {
            if(i < thoughts.length) diag.innerText = thoughts[i++];
            else { clearInterval(thinkingInterval); finishAppraisal(); }
        }, 500);
    }

    function finishAppraisal() {
        const rand = Math.random();
        let tierKey = (rand < 0.05) ? "LEGENDARY" : (rand < 0.15) ? "EPIC" : (rand < 0.35) ? "RARE" : (rand < 0.65) ? "UNCOMMON" : "COMMON";
        const tier = tiers[tierKey];
        currentVal = tier.value;
        
        document.getElementById('tier-kor').innerText = tier.kor;
        document.getElementById('tier-kor').style.color = tier.color;
        document.getElementById('stars').innerText = tier.stars;
        document.getElementById('item-name').innerText = itemList[Math.floor(Math.random()*itemList.length)];
        document.getElementById('item-val').innerText = currentVal;
        
        document.getElementById('item-info').style.display = 'block';
        document.getElementById('dialogue').innerText = `"${tier.msg}"`;
        
        const btn = document.getElementById('btn-main');
        btn.innerText = "야바위 수락";
        btn.onclick = startShuffle;
    }

    function startShuffle() {
        playing = true; finished = false;
        
        // 코인 위치 결정
        coinPos = Math.floor(Math.random()*3);
        const targetCup = document.getElementById(`slot-${coinPos}`);
        const targetStack = document.getElementById(`stack-${coinPos}`);

        // 시작 연출: 컵 들기 -> 코인 보여주기
        targetCup.classList.add('lifted');
        targetStack.classList.add('visible');

        setTimeout(() => {
            targetCup.classList.remove('lifted');
            setTimeout(() => { 
                targetStack.classList.remove('visible');
                performShuffle(0, 15);
            }, 600);
        }, 1000);
    }

    function performShuffle(count, total) {
        if(count >= total) {
            playing = false;
            document.getElementById('dialogue').innerText = "자... 어디에 들었지? 골라봐!";
            return;
        }
        let a = Math.floor(Math.random()*3), b = Math.floor(Math.random()*3);
        while(a === b) b = Math.floor(Math.random()*3);

        const cupA = document.getElementById(`slot-${a}`), cupB = document.getElementById(`slot-${b}`);
        const stackA = document.getElementById(`stack-${a}`), stackB = document.getElementById(`stack-${b}`);

        const tempLeft = cupA.style.left;
        cupA.style.left = cupB.style.left;
        cupB.style.left = tempLeft;
        stackA.style.left = stackB.style.left;
        stackB.style.left = tempLeft;

        setTimeout(() => performShuffle(count + 1, total), 350);
    }

    function select(id) {
        if(playing || finished) return;
        finished = true;
        
        // 정답 공개
        const allCups = document.querySelectorAll('.cup');
        allCups.forEach(cup => cup.classList.add('lifted'));

        // 코인이 있는 실제 위치의 스택을 찾아 보여줌
        // 로직 수정: 컵의 현재 left 위치와 코인 스택의 left 위치를 대조
        const correctStack = document.querySelector(`.coin-stack.visible`); 
        // 셔플 중에는 visible을 끄지만, 정답 확인 시 다시 켜야 함
        // 원본 코인 위치(coinPos)가 셔플 후에 어디 갔는지 확인
        const answerStack = document.getElementById(`stack-${coinPos}`);
        answerStack.classList.add('visible');

        const selectedCup = document.getElementById(`slot-${id}`);
        if(selectedCup.style.left === answerStack.style.left) {
            wallet += currentVal;
            document.getElementById('dialogue').innerText = "호오... 이걸 맞추네? 약속대로 코인을 주지.";
        } else {
            document.getElementById('dialogue').innerText = "땡! 내 손이 더 빨랐던 모양이군.";
        }

        document.getElementById('balance-display').innerText = `보유 코인: ${wallet}`;
        const btn = document.getElementById('btn-main');
        btn.innerText = "다음 물건 감정하기";
        btn.onclick = startAppraisal;
    }
</script>
</body>
</html>
