<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Black Market Pawn Shop</title>
    <style>
        :root { --bg-deep: #0a0a0b; --illegal-red: #a32a2a; }
        * { image-rendering: pixelated; box-sizing: border-box; font-family: 'Courier New', monospace; }
        
        body {
            margin: 0; height: 100vh;
            background: var(--bg-deep) url('https://github.com/bagjueun307/-/blob/main/%EC%A0%84%EC%B2%B4.png?raw=true') no-repeat center center;
            background-size: cover;
            display: flex; flex-direction: column; align-items: center;
            color: #eee; overflow: hidden;
        }

        /* [감정 애니메이션] 깜빡이는 효과 */
        @keyframes scan-glitch {
            0% { opacity: 1; filter: brightness(1); }
            20% { opacity: 0.5; filter: hue-rotate(90deg); }
            40% { opacity: 1; transform: translateX(2px); }
            60% { opacity: 0.7; transform: translateX(-2px); }
            100% { opacity: 1; }
        }
        .scanning { animation: scan-glitch 0.2s infinite; color: var(--illegal-red) !important; }

        .appraisal-sheet {
            position: absolute; top: 30px; left: 50%; transform: translateX(-50%);
            width: 480px; background: rgba(209, 209, 202, 0.95);
            border: 4px solid #111; padding: 15px; color: #111;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.6); z-index: 100;
        }

        .sheet-header { border-bottom: 2px solid #111; padding-bottom: 5px; margin-bottom: 10px; font-weight: bold; font-size: 12px; display: flex; justify-content: space-between; }
        .dialogue-text { height: 40px; font-size: 14px; font-weight: bold; margin-bottom: 10px; border-left: 4px solid var(--illegal-red); padding-left: 10px; display: flex; align-items: center; }

        .btn-group { display: flex; gap: 10px; }
        button { padding: 8px 15px; border: 3px solid #111; cursor: pointer; font-weight: bold; }
        .btn-accept { background: #4a5d4a; color: white; }
        .btn-deny { background: #8e2424; color: white; }

        .game-zone { position: absolute; bottom: 22%; width: 850px; height: 200px; }

        .cup {
            position: absolute; width: 140px; height: 160px;
            background: url('https://github.com/bagjueun307/-/blob/main/%EC%BB%B5%20%EC%97%8E%EC%9D%80%20%ED%98%95%ED%83%9C%20%EC%9D%B4%EB%AF%B8%EC%A7%80.png?raw=true') no-repeat center center;
            background-size: contain;
            transition: left 0.4s ease-in-out, transform 0.3s ease; 
            cursor: pointer; z-index: 5;
        }

        .cup.lifted {
            background-image: url('https://github.com/bagjueun307/-/blob/main/%EC%9C%84%EB%A1%9C%20%ED%96%A5%ED%95%9C%20%EC%BB%B5%20%EC%9D%B4%EB%AF%B8%EC%A7%80.png?raw=true');
            transform: translateY(-80px);
        }

        /* [코인 더미] 여러 개의 코인이 쌓인 연출 */
        .coin-stack { position: absolute; bottom: 20px; width: 140px; height: 60px; display: none; justify-content: center; align-items: flex-end; z-index: 1; }
        .coin-stack.visible { display: flex; }
        .pixel-coin {
            width: 60px; height: 60px;
            background: url('https://github.com/bagjueun307/-/blob/main/%EC%BD%94%EC%9D%B8%20%EC%9D%B4%EB%AF%B8%EC%A7%80%20%EC%A0%95%EC%B8%A1%EB%A9%B4.png?raw=true') no-repeat center center;
            background-size: contain;
            margin: 0 -15px; /* 코인이 겹치게 함 */
        }
    </style>
</head>
<body>

    <div class="appraisal-sheet">
        <div class="sheet-header">
            <span>ILLEGAL AUTHENTICATION</span>
            <span id="balance-display">WALLET: 0 COINS</span>
        </div>
        <div id="dialogue" class="dialogue-text">"물건부터 꺼내보시지."</div>
        
        <div id="item-info" style="display:none; border-top: 2px dashed #111; padding: 10px 0;">
            <div style="display:flex; justify-content: space-between; font-weight: bold;">
                <span id="item-name"></span>
                <span id="item-val"></span>
            </div>
        </div>

        <div class="btn-group">
            <button id="btn-main" class="btn-accept" onclick="startAppraisal(false)">물건 감정</button>
            <button id="btn-re" class="btn-deny" onclick="startAppraisal(true)" style="display:none;">다른 물건</button>
        </div>
    </div>

    <div class="game-zone">
        <div id="slot-0" class="cup" style="left: 50px;" onclick="select(0)"></div>
        <div id="slot-1" class="cup" style="left: 355px;" onclick="select(1)"></div>
        <div id="slot-2" class="cup" style="left: 660px;" onclick="select(2)"></div>
        
        <div id="stack-0" class="coin-stack" style="left: 50px;"></div>
        <div id="stack-1" class="coin-stack" style="left: 355px;"></div>
        <div id="stack-2" class="coin-stack" style="left: 660px;"></div>
    </div>

<script>
    let wallet = 0; let playing = false; let finished = true; let coinPos = 1; let currentVal = 0;

    const items = [
        { n: "장물 다이아", v: 100, m: "오... 빛깔 좋군. 이 정도면 판을 벌릴만 해." },
        { n: "밀수 금괴", v: 50, m: "묵직하군. 제대로 눈 크게 뜨고 보라고." },
        { n: "명품 시계", v: 20, m: "시간이 금이지. 자, 섞는다!" }
    ];

    function startAppraisal(isRetry) {
        if(playing) return;
        const diag = document.getElementById('dialogue');
        const itemInfo = document.getElementById('item-info');
        
        // 감정 애니메이션 시작
        diag.classList.add('scanning');
        itemInfo.style.display = 'none';
        diag.innerText = "AUTHENTICATING...";

        setTimeout(() => {
            diag.classList.remove('scanning');
            const item = items[Math.floor(Math.random() * items.length)];
            currentVal = item.v;
            itemInfo.style.display = 'block';
            document.getElementById('item-name').innerText = `[${item.n}]`;
            document.getElementById('item-val').innerText = `VALUE: ${item.v}`;
            diag.innerText = `"${item.m}"`;
            document.getElementById('btn-main').innerText = "야바위 수락";
            document.getElementById('btn-main').onclick = startShuffle;
            document.getElementById('btn-re').style.display = 'inline-block';
        }, 1500);
    }

    function startShuffle() {
        playing = true; finished = false;
        document.querySelectorAll('.coin-stack').forEach(s => s.classList.remove('visible'));
        
        coinPos = Math.floor(Math.random()*3);
        const targetStack = document.getElementById(`stack-${coinPos}`);
        
        // 코인 더미 생성 (가치에 따라 코인 개수 조절)
        targetStack.innerHTML = '';
        for(let i=0; i < Math.min(5, Math.ceil(currentVal/20)); i++) {
            targetStack.innerHTML += '<div class="pixel-coin"></div>';
        }

        // 시작 전 확인
        document.getElementById(`slot-${coinPos}`).classList.add('lifted');
        targetStack.classList.add('visible');

        setTimeout(() => {
            document.getElementById(`slot-${coinPos}`).classList.remove('lifted');
            setTimeout(() => { 
                targetStack.classList.remove('visible');
                performShuffle(0, 10, 0.4); 
            }, 600);
        }, 1000);
    }

    function performShuffle(count, total, speed) {
        if(count >= total) {
            playing = false;
            document.getElementById('dialogue').innerText = "자, 어느 쪽이지? 선택해.";
            return;
        }
        let a = Math.floor(Math.random()*3);
        let b = Math.floor(Math.random()*3);
        while(a === b) b = Math.floor(Math.random()*3);

        const cupA = document.getElementById(`slot-${a}`);
        const cupB = document.getElementById(`slot-${b}`);
        const stackA = document.getElementById(`stack-${a}`);
        const stackB = document.getElementById(`stack-${b}`);

        const tempLeft = cupA.style.left;
        cupA.style.left = cupB.style.left;
        cupB.style.left = tempLeft;
        stackA.style.left = stackB.style.left;
        stackB.style.left = tempLeft;

        if(coinPos === a) coinPos = b;
        else if(coinPos === b) coinPos = a;

        setTimeout(() => performShuffle(count + 1, total, speed), speed * 1100);
    }

    function select(id) {
        if(playing || finished) return;
        finished = true;
        
        // [수정] 모든 컵을 들어서 내용물 공개
        for(let i=0; i<3; i++) {
            document.getElementById(`slot-${i}`).classList.add('lifted');
            if(i === coinPos) {
                document.getElementById(`stack-${i}`).classList.add('visible');
            }
        }

        if(id === coinPos) {
            wallet += currentVal;
            document.getElementById('dialogue').innerText = "호오, 제법인데? 여기 코인 가져가라고.";
        } else {
            document.getElementById('dialogue').innerText = "땡! 이건 내 거야. 운이 없었군.";
        }

        document.getElementById('balance-display').innerText = `WALLET: ${wallet} COINS`;
        setTimeout(() => {
            document.querySelectorAll('.cup').forEach(c => c.classList.remove('lifted'));
            document.querySelectorAll('.coin-stack').forEach(s => s.classList.remove('visible'));
            document.getElementById('btn-main').innerText = "다른 물건 꺼내기";
            document.getElementById('btn-main').onclick = () => startAppraisal(false);
        }, 3000);
    }
</script>
</body>
</html>
